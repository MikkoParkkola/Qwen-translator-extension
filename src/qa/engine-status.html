<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>WASM Engine Status</title>
  <style>
    body { font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial; margin: 16px; }
    table { border-collapse: collapse; }
    td, th { border: 1px solid #ddd; padding: 6px 10px; }
    th { background: #f7f7f7; text-align: left; }
    .ok { color: #2e7d32; }
    .miss { color: #d32f2f; }
  </style>
</head>
<body>
  <h1>WASM Engine Status</h1>
  <p>This page checks whether required vendor assets are present and reachable from the extension.</p>
  <table>
    <thead><tr><th>File</th><th>Status</th></tr></thead>
    <tbody id="rows"></tbody>
  </table>
  <p id="summary" style="margin-top:10px"></p>
  <script type="module">
    const files = [
      'wasm/vendor/hb.wasm',
      'wasm/vendor/hb.js',
      'wasm/vendor/pdfium.wasm',
      'wasm/vendor/pdfium.js',
      'wasm/vendor/mupdf.wasm',
      'wasm/vendor/mupdf.js',
      'wasm/vendor/icu4x_segmenter.wasm',
      'wasm/vendor/icu4x_segmenter.js',
      'wasm/vendor/fonts/NotoSans-Regular.ttf',
      'wasm/vendor/fonts/NotoSans-Bold.ttf',
    ];
    const rows = document.getElementById('rows');
    const summary = document.getElementById('summary');
    async function check() {
      rows.innerHTML='';
      let ok = 0;
      for (const f of files) {
        const tr = document.createElement('tr');
        const td1 = document.createElement('td'); td1.textContent = f; tr.appendChild(td1);
        const td2 = document.createElement('td'); td2.textContent = 'Checkingâ€¦'; tr.appendChild(td2);
        rows.appendChild(tr);
        try {
          const url = chrome.runtime.getURL(f);
          const resp = await fetch(url, { method: 'HEAD' });
          if (resp.ok) {
            const size = resp.headers.get('content-length');
            td2.textContent = size ? `OK (${Number(size).toLocaleString()} bytes)` : 'OK';
            td2.className='ok'; ok++;
          } else {
            td2.textContent = 'Missing ('+resp.status+')'; td2.className='miss';
          }
        } catch (e) {
          td2.textContent = 'Missing'; td2.className='miss';
        }
      }
      summary.textContent = `Ready ${ok}/${files.length}`;
    }
    check();
    setInterval(check, 3000);
  </script>
</body>
</html>
