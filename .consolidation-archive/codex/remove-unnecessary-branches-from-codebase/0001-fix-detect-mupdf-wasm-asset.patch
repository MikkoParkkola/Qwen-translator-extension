From 07b872083a4e6899429dca51c646ddc342b52eab Mon Sep 17 00:00:00 2001
From: MikkoParkkola <78788115+MikkoParkkola@users.noreply.github.com>
Date: Sun, 10 Aug 2025 03:59:35 +0200
Subject: [PATCH] fix: detect mupdf wasm asset

---
 src/wasm/engine.js | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/wasm/engine.js b/src/wasm/engine.js
index 5cf9d13..fcdcf1f 100644
--- a/src/wasm/engine.js
+++ b/src/wasm/engine.js
@@ -9,12 +9,12 @@ async function check(base, path) {
   try { const r = await fetch(base + path, { method: 'HEAD' }); return r.ok; } catch { return false; }
 }
 
-async function chooseEngine(base, requested) {
+export async function chooseEngine(base, requested) {
   const wants = (requested || 'auto').toLowerCase();
   const hbOk = await check(base, 'hb.wasm');
   const icuOk = (await check(base, 'icu4x_segmenter.wasm')) || (await check(base, 'icu4x_segmenter_wasm_bg.wasm'));
   const pdfiumOk = await check(base, 'pdfium.wasm');
-  const mupdfOk = await check(base, 'mupdf.wasm');
+  const mupdfOk = (await check(base, 'mupdf.wasm')) || (await check(base, 'mupdf-wasm.wasm'));
   const overlayOk = await check(base, 'pdf-lib.js');
 
   function pick() {
-- 
2.50.0

