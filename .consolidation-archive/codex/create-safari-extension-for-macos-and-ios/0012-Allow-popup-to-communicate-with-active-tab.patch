From 5f0c6ee23dc21a13c35d7d268008d9913df0fff9 Mon Sep 17 00:00:00 2001
From: MikkoParkkola <78788115+MikkoParkkola@users.noreply.github.com>
Date: Wed, 30 Jul 2025 17:44:10 +0200
Subject: [PATCH 12/44] Allow popup to communicate with active tab

---
 README.md         | 2 ++
 src/manifest.json | 8 +++++++-
 src/popup.html    | 1 +
 3 files changed, 10 insertions(+), 1 deletion(-)

diff --git a/README.md b/README.md
index 1e309bd..d1519ea 100644
--- a/README.md
+++ b/README.md
@@ -7,6 +7,8 @@ This Chrome extension translates the content of the active tab using Alibaba Clo
 2. Build the extension by copying the `src` folder contents into a folder of your choice.
 3. In your Chromium based browser open the extensions page and enable "Developer mode".
 4. Choose "Load unpacked" and select the folder containing the extension files.
+   The extension requests the "tabs" permission so the popup can send
+   messages to the active tab for translation.
 
 ## Uninstallation
 Remove the extension from the browser's extension management page.
diff --git a/src/manifest.json b/src/manifest.json
index 874efba..a5103e8 100644
--- a/src/manifest.json
+++ b/src/manifest.json
@@ -3,7 +3,7 @@
   "name": "Qwen Translator",
   "description": "Translate pages using Qwen-MT-Turbo",
   "version": "1.0",
-  "permissions": ["storage", "activeTab", "scripting"],
+  "permissions": ["storage", "activeTab", "tabs", "scripting"],
   "host_permissions": [
     "https://dashscope-intl.aliyuncs.com/*"
   ],
@@ -14,6 +14,12 @@
     "default_popup": "popup.html",
     "default_title": "Qwen Translator"
   },
+  "web_accessible_resources": [
+    {
+      "resources": ["translator.js", "config.js", "languages.js"],
+      "matches": ["<all_urls>"]
+    }
+  ],
   "content_scripts": [
     {
       "matches": ["<all_urls>"],
diff --git a/src/popup.html b/src/popup.html
index f6a79ac..9c7ab64 100644
--- a/src/popup.html
+++ b/src/popup.html
@@ -21,6 +21,7 @@
   <button id="save">Save</button>
   <button id="test">Test Settings</button>
   <div id="status"></div>
+  <script src="translator.js"></script>
   <script src="config.js"></script>
   <script src="languages.js"></script>
   <script src="popup.js"></script>
-- 
2.50.0

