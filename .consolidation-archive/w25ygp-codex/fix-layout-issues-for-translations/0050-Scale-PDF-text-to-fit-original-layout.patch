From ee50080e7fc5533218d5be42932618b870d89f28 Mon Sep 17 00:00:00 2001
From: MikkoParkkola <78788115+MikkoParkkola@users.noreply.github.com>
Date: Wed, 6 Aug 2025 22:45:03 +0200
Subject: [PATCH 50/51] Scale PDF text to fit original layout

---
 src/pdfViewer.js | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/src/pdfViewer.js b/src/pdfViewer.js
index bda95ce..0449909 100644
--- a/src/pdfViewer.js
+++ b/src/pdfViewer.js
@@ -56,8 +56,20 @@
           console.error('PDF translation failed', e);
         }
       }
+      const measure = document.createElement('canvas').getContext('2d');
       textContent.items.forEach((it, i) => {
         it.str = translated[i];
+        const style = textContent.styles[it.fontName];
+        if (style) {
+          const fontSize = Math.hypot(it.transform[0], it.transform[1]);
+          measure.font = `${fontSize}px ${style.fontFamily}`;
+          const w = measure.measureText(it.str).width;
+          if (w > 0 && it.width) {
+            const scale = it.width / w;
+            it.transform[0] *= scale;
+            it.transform[1] *= scale;
+          }
+        }
       });
       pdfjsLib.renderTextLayer({
         textContent,
-- 
2.50.0

