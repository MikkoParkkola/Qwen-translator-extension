From ce7b93ecdba62cf7aab7382e38d1ad6a06d5c1aa Mon Sep 17 00:00:00 2001
From: MikkoParkkola <78788115+MikkoParkkola@users.noreply.github.com>
Date: Sun, 3 Aug 2025 13:53:41 +0200
Subject: [PATCH 43/47] Add Safari build support

---
 README.md                 |  9 +++++++++
 package.json              |  3 ++-
 safari/README.md          |  6 ++++++
 scripts/convert-safari.sh | 22 ++++++++++++++++++++++
 src/manifest.json         |  4 ++++
 5 files changed, 43 insertions(+), 1 deletion(-)
 create mode 100644 safari/README.md
 create mode 100755 scripts/convert-safari.sh

diff --git a/README.md b/README.md
index d6fe394..9fa21b0 100644
--- a/README.md
+++ b/README.md
@@ -20,6 +20,15 @@ Remove the extension from the browser's extension management page.
 ## Upgrade
 Reload the unpacked extension after replacing the files with a newer version.
 
+### Safari (macOS and iOS/iPadOS)
+Run the Safari converter on a Mac to produce an Xcode project for both macOS and iOS/iPadOS:
+
+```sh
+npm run build:safari
+```
+
+Open the generated project in Xcode to sign and build the extension for the desired platform.
+
 ## Configuration
 Use the popup to configure:
 - API key and optional endpoint (keep your API key private)
diff --git a/package.json b/package.json
index 12e0a95..3a28d09 100644
--- a/package.json
+++ b/package.json
@@ -4,7 +4,8 @@
   "description": "Extension to translate web pages using Qwen-MT-Turbo model",
   "main": "index.js",
   "scripts": {
-    "test": "jest"
+    "test": "jest",
+    "build:safari": "bash scripts/convert-safari.sh"
   },
   "keywords": [],
   "author": "",
diff --git a/safari/README.md b/safari/README.md
new file mode 100644
index 0000000..fec4833
--- /dev/null
+++ b/safari/README.md
@@ -0,0 +1,6 @@
+# Safari WebExtension
+
+This directory is the default output location for the Safari web-extension converter.
+Run `npm run build:safari` on macOS to generate an Xcode project for macOS and iOS/iPadOS.
+
+Open the generated project in Xcode to build and sign the extension for each platform.
diff --git a/scripts/convert-safari.sh b/scripts/convert-safari.sh
new file mode 100755
index 0000000..8817635
--- /dev/null
+++ b/scripts/convert-safari.sh
@@ -0,0 +1,22 @@
+#!/usr/bin/env bash
+set -euo pipefail
+
+SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
+SRC_DIR="$SCRIPT_DIR/../src"
+OUT_DIR="$SCRIPT_DIR/../safari"
+
+mkdir -p "$OUT_DIR"
+
+# Convert for macOS
+xcrun safari-web-extension-converter "$SRC_DIR" \
+  --app-name "Qwen Translator" \
+  --bundle-identifier "com.example.qwentranslator.macos" \
+  --project-location "$OUT_DIR" \
+  --macos-only
+
+# Convert for iOS and iPadOS
+xcrun safari-web-extension-converter "$SRC_DIR" \
+  --app-name "Qwen Translator" \
+  --bundle-identifier "com.example.qwentranslator.ios" \
+  --project-location "$OUT_DIR" \
+  --ios-only
diff --git a/src/manifest.json b/src/manifest.json
index 8bbf583..c3a7fc5 100644
--- a/src/manifest.json
+++ b/src/manifest.json
@@ -29,4 +29,8 @@
       "all_frames": true
     }
   ]
+  ,
+  "safari": {
+    "id": "com.example.qwentranslator"
+  }
 }
-- 
2.50.0

